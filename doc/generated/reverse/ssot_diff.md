# SSOT差分提案

## このドキュメントについて

コード解析の結果、SSOT（`doc/input/rdd.md`, `doc/input/architecture.md`）との差分を検出した場合に記録します。

**更新日時**: 2026-02-08

---

## 検出された差分

### 1. Next.jsバージョン表記の不整合

| 項目 | SSOT (rdd.md) | CLAUDE.md | 実際のpackage.json |
|------|--------------|-----------|-------------------|
| Next.js | 16 | 16 | **16.1.6** |

**検証結果**: `apps/web/package.json` で `"next": "16.1.6"` を確認。

**対応**: RDD・CLAUDE.md・リバースドキュメントすべてを Next.js 16 に統一

**ステータス**: ✅ 解決済み（2026-02-02）

---

### 2. Content Script マッチパターンの不整合

| 項目 | CLAUDE.md (旧) | 実際のコード |
|------|---------------|-------------|
| Gemini | `*://*.google.com/*` | `*://gemini.google.com/*` |

**対応**: CLAUDE.md のマッチパターンを実際のコードに合わせて修正済み

**ステータス**: ✅ 解決済み（2026-02-02）

---

### 3. README.md の Next.js バージョン表記

| 項目 | README.md | 実際のpackage.json |
|------|-----------|-------------------|
| Next.js | 15 | **16.1.6** |

**対応提案**: README.md の技術スタックテーブルを `Next.js 16` に更新する

**ステータス**: ⚠️ 未解決

---

## 今後の検討事項

### A. 認証機能の追加（RDD記載）

- **RDD記載**: 「Firebase Auth想定（後日）」
- **現状**: 認証未実装（MVP段階）
- **提案**: Sprint 3以降で Firebase Auth を追加
- **マイグレーション計画（認証追加時）**:
  1. 既存データのオーナーシップ割り当て（単一ユーザー→userId付与）
  2. APIバージョニング検討
  3. 拡張機能の認証フロー追加
  4. CSRF対策の導入（認証トークン使用時に必須）

### B. テスト戦略の実装（RDD記載）

- **RDD記載**: 「テスト戦略: Vitest（後日追加）」
- **現状**: テストファイルなし
- **提案**: Sprint 3以降で Vitest を導入

### C. 観測性の実装（RDD記載）

- **RDD記載**: 「観測性: Cloud Logging（後日）」
- **現状**: `console.log` / `console.error` のみ
- **提案**: Cloud Run デプロイ時に Cloud Logging を統合

### D. スペース機能（Sprint 3 予定、RDD記載）

- **RDD記載**: P1優先度で「複数の対話をグループ化し、統合コンテキストで対話」
- **現状**: 未実装
- **Issue**: #12 (TASK-11: データモデル・API), #13 (TASK-12: スペースUI)

### E. router.push 対応（Issue #36）

- **現状**: `useUnsavedChangesWarning` は `router.push()` による遷移を検知できない
- **提案**: Sprint 3で対応検討

---

## 変更要求が必要な場合のテンプレート

```
Change Request: {タイトル}
- RDD参照: doc/input/rdd.md §{該当セクション}
- 現状の制約: {なぜRDD準拠だと難しいか}
- 提案差分: {スタック/設計の変更内容（最小）}
- 影響: {テスト/運用/セキュリティ/コスト}
- 代替案: {検討したが採用しない案}
- 戻し方: {ロールバック手順}
- 推奨: 承認/却下の判断材料
```

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-02-02 | 初回作成、マッチパターン不整合を解決 |
| 2026-02-02 | Next.jsバージョン再検証、全ドキュメント統一完了 |
| 2026-02-02 | 認証マイグレーション計画、データバリデーション優先度を追記 |
| 2026-02-08 | Sprint 2完了時点で更新。Insightコレクション追加、Sprint 3予定事項追記 |
| 2026-02-08 | README.mdのバージョン不整合を検出 |
