---
marp: true
theme: default
paginate: true
---

<!-- _class: lead -->
# 📘 RDD: 要件定義書
プロジェクト名: ZennHackathon04 - 思考再開AIエージェント
作成日: 2026-01-28
作成者: mae

---

# 🤖 AI用：事実ブロック（ここだけ先に埋める）
> ここは「判断」ではなく「事実」だけを書く。設計方針・理由・解説は skills / ADR-lite に寄せる。

## 技術スタック（事実）
- モノレポ: pnpm workspaces
- フロント/バックエンド: Next.js 16 App Router（Cloud Run想定）
- 拡張機能: WXT（Manifest V3、Chrome Extension）
- 共通スキーマ: Zod
- AI: Vertex AI (Gemini)
- データ: Firestore

## ターゲット表示環境（事実）
> デザインの"見た目基準"にするビューポート。
- 主要（desktop）: 1440x900（Web管理画面）
- 拡張機能: Chrome Extension Popup（400x600）
- 補足: 最小対応幅 1024px、Chrome最新版

## 制約（事実）
- 期限/体制: Hackathon（短期集中開発）
- 運用条件: GCP統一（Cloud Run + Firestore + Vertex AI）
- 外部依存: ChatGPT/Claude/Gemini WebサイトのDOM構造
- コンプラ/ライセンス: MIT想定

## 参照（事実）
- アーキテクチャ: `doc/Architecture.md`（未作成）
- デザイン: `doc/input/design/thinkresume.pen`（Pencilファイル）

---

# 🎯 プロジェクト概要
## コンテキスト（AI用）
- 目的: LLM対話から「重要なやり取り」を選び、思考を再開するAIエージェント
- 背景: LLMとの対話は使い捨てになりがち。重要な洞察や議論を保存・再利用できない
- 想定ユーザー像: エンジニア、リサーチャー、LLMヘビーユーザー

## 人間レビュー用
- なぜこのプロジェクトを作るのか: LLMとの対話履歴を資産化し、思考の継続性を実現する
- どんなユーザーのどんな課題を解決するのか: LLMとの重要な対話を見失う・再開できない課題
- **一言まとめ:** 「LLM対話のブックマーク＆思考再開」ツール

---

# 🧑‍💻 ユースケース
## コンテキスト（AI用）
- シナリオ1: ChatGPTで重要な議論→拡張機能で保存→後日Geminiで思考再開
- シナリオ2: 保存した対話一覧から検索→要約を見て思い出す→再開ボタンで継続
- **MVP範囲**: 対話保存（拡張）→一覧・詳細表示（Web）→思考再開（基本）

## 人間レビュー用
- 利用シーンをストーリーボード的に説明
  1. ユーザーがChatGPT/Claude/Geminiで対話中
  2. 「この対話は重要」と思ったら拡張機能ボタンをクリック
  3. タイトル・メモを入力して保存
  4. 後日、Web管理画面で保存済み対話を閲覧
  5. 「思考再開」ボタンでGeminiに対話をインジェクトして継続

---

# 🏗️ 機能要件
## コンテキスト（AI用）
- **機能一覧（優先度順）**
  1. [P0] 対話キャプチャ（Chrome拡張）: ChatGPT/Claude/GeminiのDOMから対話を取得
  2. [P0] 対話保存API（Next.js API Routes）: Firestoreに保存
  3. [P0] 対話一覧・詳細表示（Web）: 保存済み対話の閲覧
  4. [P1] 思考再開機能: 保存した対話をGeminiに渡して継続
  5. [P1] スペース機能: 複数の対話をグループ化し、統合コンテキストで対話
  6. [P1] 追加した洞察: Geminiとの対話からQ&A形式で重要な洞察を保存
  7. [P2] タグ・検索機能: 対話の整理・検索

- **DoD（完了条件）**
  - 対話がFirestoreに正しく保存される
  - Web画面で保存済み対話が閲覧できる
  - 基本的な思考再開が動作する

## 機能詳細仕様（決定済み）

### 対話キャプチャ（Chrome拡張）
- **トリガー**: 手動ボタンのみ（拡張機能アイコンクリック → ポップアップ）
- **キャプチャ範囲**:
  - MVP: 対話全体（ページ内の全メッセージ）
  - 追加実装: 選択範囲 + コンテキスト要約（選択前の対話をGeminiで自動要約して付加）
- **保存時の入力項目**（全てAI自動生成 + 編集可）:
  - タイトル: Geminiが対話内容から自動生成
  - メモ: Geminiが要点を自動要約
  - タグ: Geminiが自動提案（追加・削除可）
- **フロー**: キャプチャ → Gemini自動生成（ローディング） → ポップアップ表示 → 確認・編集 → 保存

### 思考再開機能（Web）
- **UI構成**（同一画面で上から順に表示）:
  1. 保存した対話履歴（元のLLM対話）
  2. メモ・要件など（ユーザーが追加した情報、編集・追記可能）
  3. 追加した洞察（Gemini対話から保存したQ&A形式の洞察一覧）
  4. Geminiと対話（思考再開チャットUI、ストリーミング表示）
- **コンテキスト継続**: 保存した対話 + メモを元にGeminiが文脈を引き継いで応答
- **洞察として保存**: Gemini対話パネルで選択したやり取りを「追加した洞察」に保存可能

### スペース機能（Web）
- **概要**: 複数の対話をグループ化し、統合コンテキストで思考を継続
- **UI構成**（スペース詳細画面、上から順に表示）:
  1. 含まれる対話（このスペースに属する対話一覧）
  2. メモ・要件など（スペース全体のメモ、編集・追記可能）
  3. 追加した洞察（Q&A形式の洞察一覧）
  4. 統合コンテキストで対話（複数対話を統合してGeminiと対話）
- **統合コンテキスト**: スペース内の全対話 + メモを統合してGeminiに渡す
- **洞察として保存**: 思考再開と同様、Gemini対話から洞察を保存可能

### メモ・要件の編集機能
- **編集モード**: 既存メモの直接編集が可能
- **追記機能**: タイムスタンプ付きで新しいメモを追記
- **表示形式**: 追記分は「YYYY/MM/DD HH:MM 追記」の形式で区切り表示

### 洞察保存のUI仕様
- **保存ボタンの表示位置**: Geminiの回答メッセージにのみ「+ 洞察として保存」ボタンを表示
- **保存内容**: ボタン押下時、直前のユーザー質問も含めてQ&Aペアとして保存
- **例外**: Geminiの最初の挨拶メッセージ（「何か質問ありますか？」等）には保存ボタンを出さない
- **理由**: Q&A形式で洞察を蓄積するため、回答起点で保存するのが自然

### Gemini対話のUIパターン
- **会話の流れ**:
  1. Gemini（挨拶）: 「前回の議論を踏まえて...何か質問ありますか？」→ 保存ボタンなし
  2. ユーザー（質問）: ユーザーの入力 → ボタンなし
  3. Gemini（回答）: 回答内容 → 「+ 洞察として保存」ボタンあり
- **ストリーミング表示**: Geminiの回答はストリーミングで表示

### Web画面のナビゲーション構成
- **サイドバーメニュー**（全画面共通）:
  1. 対話一覧（message-squareアイコン）
  2. スペース（layout-gridアイコン）
  3. 設定（settingsアイコン）※MVP段階ではページ未実装
- **アクティブ状態**: 現在のページに応じて該当メニューがハイライト
- **検索**: サイドバーではなく、各一覧画面のヘッダーに検索UIを配置

### 対話カードの表示要素
- **ヘッダー**: タイトル、ソースバッジ（ChatGPT/Claude/Gemini）、日時
- **本文**: メモ（Geminiが自動生成した要約）
- **フッター**: タグ一覧、洞察バッジ（「💡 N件の洞察」）
- **アクション**: 「思考を再開」ボタン、メニュー（...）

### スペースカードの表示要素
- **ヘッダー**: アイコン、メニュー（...）
- **本文**: タイトル、説明文
- **統計**: 「対話 N件」「洞察 N件」

## 人間レビュー用
- 機能ごとの簡易図: （後日追加）

---

# 🛡️ 非機能要件
## コンテキスト（AI用）
- パフォーマンス: Hackathon規模なので特に制約なし
- セキュリティ: Firebase Auth想定（後日）、API Key管理必須
- 可用性: GCP Cloud Runの標準SLA
- 運用要件: Hackathon期間中のみ

## 人間レビュー用
- MVP段階ではセキュリティは最小限（自分用ツール想定）
- 公開前にFirebase Auth追加必須

---

# ⚙️ 技術スタック
## コンテキスト（AI用）
- 言語/ランタイム: TypeScript 5.9+, Node.js 20+
- フレームワーク: Next.js 16 (App Router), WXT (Chrome Extension)
- DB/インフラ: Firestore, Cloud Run, Vertex AI
- テスト戦略: Vitest（後日追加）
- 観測性: Cloud Logging（後日）

## 人間レビュー用
- 選定理由:
  - pnpm workspaces: Hackathon規模でシンプル
  - Next.js 16: Cloud Run対応、API Routes統合
  - WXT: 2025年Chrome拡張デファクト、HMR優秀
  - GCP統一: 認証・インフラ管理を簡素化

---

# 🚫 非目標
## コンテキスト（AI用）
- 今回スコープ外のもの:
  - マルチユーザー対応
  - 高度な検索・フィルタ機能
  - モバイルアプリ
  - Firefox拡張

## 人間レビュー用
- 今回やらない理由: Hackathon期間内で完成させるため、単一ユーザー・Chrome限定

---

# 📐 制約
## コンテキスト（AI用）
- 組織/予算/スケジュール: Hackathon（数日間）
- 外部依存: LLMサイトのDOM構造変更リスク
- ライセンス: MIT

## 人間レビュー用
- リスク: ChatGPT/Claude/GeminiのDOM構造が変わると拡張機能が壊れる
- 対策: セレクタを定数化して変更容易に

---

# 🎨 デザイン方針（任意）
## コンテキスト（AI用）
- デザインシステム: Tailwind CSS
- デザイン指針: シンプル・ミニマル
- プロダクト名: ThinkResume
- キャッチコピー: 「LLMとの対話を、資産に変える」
- カラー: 赤（$--red-primary）をアクセントカラーとして使用

## 人間レビュー用
- 画面の雰囲気: ライトモード基調、読みやすさ重視
- ブランド要件: ThinkResumeロゴ（赤い四角 + Space Grotesk）

---

# 📑 参照
## コンテキスト（AI用）
- `doc/Architecture.md`（未作成）
- `doc/design/`
- WXT公式: https://wxt.dev/
- Next.js 16: https://nextjs.org/

## 人間レビュー用
- 追加資料は随時追加
